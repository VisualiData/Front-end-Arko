{{ define "content" }}
<ul class="stats-list">
  <li class="stats-list-positive">
    <span id="active"></span> <span class="stats-list-label">Active</span>
  </li>
  <li class="stats-list-warning">
    <span id="warning"></span> <span class="stats-list-label">Intermittent failures</span>
  </li>
  <li class="stats-list-negative">
    <span id="inactive"></span> <span class="stats-list-label">Inactive</span>
  </li>
</ul>

<a class="button" href="sensor/add">Add sensor</a>
<div class="row" id="floor_plan_container">
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>
var active = 0;
var warning = 0;
var inactive = 0;
  var plans = ["CHIBB_0", "CHIBB_1", "CHIBB_2"];
  var data = {{ marshal .Data }};
  plans.forEach(function(value) {
    var $div = $("<div>", {
      id: value,
      "class": "columns large-12"
    });
    $("#floor_plan_container").append($div);
    var img_buffer = document.createElement('img');
    img_buffer.src = '/assets/img/' + value + '.png';
    $('<canvas></canvas>', {
      id: "canvas_" + value,
      'style': 'width: 100%'
    }).appendTo("#" + value);
    var canvas = document.getElementById("canvas_" + value);
    var context = canvas.getContext('2d');
    img_buffer.onload = function() {
      imgWidth = img_buffer.width;
      imgHeight = img_buffer.height;
      naturalWidth = img_buffer.naturalWidth;
      naturalHeight = img_buffer.naturalHeight;
      canvas.width = imgWidth;
      canvas.height = imgHeight;
      context.drawImage(img_buffer, 0, 0, imgWidth, imgHeight);
      var vars = value.split("_");
      var wanted = data.filter( function(item){return (item.position.floor==vars[1]  &&  item.position.house == vars[0]);} );
      wanted.forEach(function(sensor){
        context.beginPath();
        context.arc(sensor.position.x, sensor.position.y, 10, 0, 2 * Math.PI);
        if(sensor.status == "active"){
            context.fillStyle = 'green';
            active++;
        } else if (sensor.status == "intermittent failures"){
        context.fillStyle = 'orange';
        warning++;
      } else {
        context.fillStyle = 'red';
        inactive++;
      }
      context.fill();
        context.stroke();
      });
      // console.log(active);
      $("#active").text(active);
      // console.log(warning);
      $("#warning").text(warning);
      // console.log(inactive);
      $("#inactive").text(inactive);
    }
  });
</script>
{{ end }}
